\[ [Index](index.md) | [Exercise 1.3](ex1_3.md) | [Exercise 1.5](ex1_5.md) \]

# Упражнение 1.4

_Задачи:_

- Повторение основ определения простых функций
- Обработка исключений

_Созданные файлы:_ None

_Изменяемые файлы:_ `pcost.py`

## (a) Определение функции

Возьмите программу `pcost.py`, которую вы написали в последнем упражнении,
и преобразуйте ее в функцию `portfolio_cost(filename)`, которая принимает имя файла в качестве входного параметра,
считывает данные о портфеле из этого файла и возвращает общую стоимость портфеля в виде числа с плавающей запятой.
После того, как вы напишете функцию, добавьте в программу следующий оператор:

```python
print(portfolio_cost('Data/portfolio.dat'))
```

Запустите программу и убедитесь, что она выводит тот же результат, что и раньше.

## (b) Добавление обработки ошибок

При написании программ для обработки данных часто возникают ошибки, связанные с некорректными данными (нарушенные структуры, отсутствующие поля и т.д.).
Измените вашу программу `pcost.py`, чтобы она считывала файл `Data/portfolio3.dat` и запустите ее (подсказка: она должна завершиться с ошибкой).

Слегка измените вашу функцию, чтобы она могла обрабатывать строки с некорректными данными.
Например, функции преобразования int() и float() генерируют исключение ValueError, если не могут выполнить преобразование ввода.
Используйте конструкцию try и except, чтобы перехватывать и выводить предупреждающее сообщение о строках, которые не могут быть обработаны.
Например:

```
Не удалось разобрать: 'C - 53.08\n'
Причина: invalid literal for int() with base 10: '-'
Не удалось разобрать: 'DIS - 34.20\n'
Причина: invalid literal for int() with base 10: '-'
...
```

Повторно запустите вашу программу на файле `Data/portfolio3.dat`.
Несмотря на вывод предупреждающих сообщений, она должна успешно выполниться.

## (c) Интерактивный эксперимент

Запустите вашу программу `pcost.py` и вызовите функцию `portfolio_cost()` напрямую из интерактивной оболочки.

```python
>>> portfolio_cost('Data/portfolio.dat')
44671.15
>>> portfolio_cost('Data/portfolio2.dat')
19908.75
>>>
```

Примечание: Для этого вам может потребоваться запустить Python с опцией -i. Например:

```
bash % python3 -i pcost.py
```

Мы будем писать много программ, в которых вы будете определять функции и экспериментировать интерактивно.
Убедитесь, что вы знаете, как это делать.

\[ [Solution](soln1_4.md) | [Index](index.md) | [Exercise 1.3](ex1_3.md) | [Exercise 1.5](ex1_5.md) \]

---

`>>>` Advanced Python Mastery  
`...` A course by [dabeaz](https://www.dabeaz.com)  
`...` Copyright 2007-2023

![](https://i.creativecommons.org/l/by-sa/4.0/88x31.png). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 International License](http://creativecommons.org/licenses/by-sa/4.0/)
