\[ [Index](index.md) | [Exercise 3.1](ex3_1.md) | [Exercise 3.3](ex3_3.md) \]

# Упражнение 3.2

*Задачи:*

- Изучить доступ к атрибутам
- Изучить использование функций `getattr()`, `setattr()` и связанных функций.
- Попробовать использовать привязанные методы.


*Созданные файлы:* `tableformat.py`

## (a) Три операции

Вся система объектов Python состоит всего из трех основных операций: 
получение, установка и удаление атрибутов. Обычно они доступны 
с помощью точки (.) вот так:

```python
>>> s = Stock('GOOG', 100, 490.1)
>>> s.name    #  get
'GOOG'
>>> s.shares = 50    # set
>>> del s.shares     # delete
>>>
```

Три операции также доступны в виде функций. Например:

```python
>>> getattr(s, 'name')            # То же что s.name
'GOOG'
>>> setattr(s, 'shares', 50)      # То же что s.shares = 50
>>> delattr(s, 'shares')          # То же что del s.shares
>>>
```

Дополнительная функция `hasattr()` может использоваться для проверки наличия атрибута в объекте:
```python
>>> hasattr(s, 'name')
True
>>> hasattr(s, 'blah')
False
>>>
```

## (b) Использование getattr()

Функция `getattr()`  чрезвычайно полезна при написании кода, который 
обрабатывает объекты очень общим способом. Для иллюстрации рассмотрим 
следующий пример, который выводит набор пользовательских атрибутов:

```python
>>> s= Stock('GOOG', 100, 490.1)
>>> fields = ['name','shares','price']
>>> for name in fields:
           print(name, getattr(s, name))

name GOOG
shares 100
price 490.1
>>>
```

## (c) Вывод таблицы

В [Упражнении 3.1](ex3_1.md), ты написал функцию `print_portfolio()`, которая 
создает красиво оформленную таблицу. Эта функция была специально написана для 
списка объектов Stock. Однако ее можно полностью обобщить для работы с 
любым списком объектов, используя методику из Раздела (b).

Создай новый модуль с именем `tableformat.py`.  В этой программе напиши 
функцию `print_table()`, которая принимает последовательность (список) объектов, 
список имен атрибутов и выводит красиво отформатированную таблицу. Например:

```python
>>> import stock
>>> import tableformat
>>> portfolio = stock.read_portfolio('Data/portfolio.csv')
>>> tableformat.print_table(portfolio, ['name','shares','price'])
      name     shares      price
---------- ---------- ---------- 
        AA        100       32.2
       IBM         50       91.1
       CAT        150      83.44
      MSFT        200      51.23
        GE         95      40.37
      MSFT         50       65.1
       IBM        100      70.44

>>> tableformat.print_table(portfolio,['shares','name'])
    shares       name
---------- ---------- 
       100         AA
        50        IBM
       150        CAT
       200       MSFT
        95         GE
        50       MSFT
       100        IBM
>>> 
```

Для простоты пусть функция `print_table()` просто выводит каждое 
поле в столбце шириной 10 символов.

## (d) Привязанные методы

Может быть удивительно, но вызовы методов основаны на механизмах, 
используемых для простых атрибутов. По сути, метод - это атрибут, 
который выполняется при добавлении необходимых круглых скобок () 
для его вызова как функции. Например:

```python
>>> s = Stock('GOOG',100,490.10)
>>> s.cost           # Ищет метод
<bound method Stock.cost of <__main__.Stock object at 0x409530>>
>>> s.cost()         # Ищет и вызывает метод
49010.0

>>> # Те же операции используя getattr()
>>> getattr(s, 'cost')
<bound method Stock.cost of <__main__.Stock object at 0x409530>>
>>> getattr(s, 'cost')()
49010.0
>>> 
```

Привязанный метод привязан к объекту, откуда он был получен. 
Если этот объект изменяется, метод будет видеть эти изменения. 
Исходный объект можно просмотреть, проверив атрибут `__self__` метода.

```python
>>> c = s.cost
>>> c()
49010.0
>>> s.shares = 75
>>> c()
36757.5
>>> c.__self__
<__main__.Stock object at 0x409530>
>>> c.__func__
<function cost at 0x37cc30>
>>> c.__func__(c.__self__)      # Вот что происходит при вызове c()
36757.5
>>>
```

Попробуй сделать это с методом `sell()` чтобы убедиться, что ты понимаешь механику:

```python
>>> f = s.sell
>>> f.__func__(f.__self__, 25)     # То же что s.sell(25)
>>> s.shares
50
>>>
```

\[ [Solution](soln3_2.md) | [Index](index.md) | [Exercise 3.1](ex3_1.md) | [Exercise 3.3](ex3_3.md) \]

----
`>>>` Advanced Python Mastery  
`...` A course by [dabeaz](https://www.dabeaz.com)  
`...` Copyright 2007-2023  

![](https://i.creativecommons.org/l/by-sa/4.0/88x31.png). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 International License](http://creativecommons.org/licenses/by-sa/4.0/)
